@page "/StudentDetail/{id:int}"

@using TeddyBlazor.Services
@using TeddyBlazor.Models
@using TeddyBlazor.Components
@using TeddyBlazor.ViewModels

@inject StudentDetailViewModel vm
<div class="maincanvas">
    <h1>@vm.Student.Name</h1>
    <br />
    <h3>Notes:</h3>
    <div class="notes">

        <div class="notes-item1">
            <h1>Positives</h1>
            <div class="jumbotron centered">
                @foreach (var note in vm.GetNotes())
                {
                    <p>@note.Content</p>
                }
            </div>

            <input type="text"
                   placeholder="New Note"
                   @bind="vm.NewNote" />
            <button class="btn btn-secondary"
                    type="submit"
                    @onclick="vm.AddNote">
                Add Note
            </button>
            <br />
            <input type="radio" name="SignIt" value="Sign it?" checked />Sign it
            <input type="radio" name="SignIt" value="Dont sign it?" />Dont sign it
            <div class="text-danger">@vm.errorAlert</div>
        </div>
        <div class="note-item2">
            <h1>Negatives</h1>
            <div class="jumbotron centered">
                @foreach (var note in vm.GetNotes())
                {
                    <p>@note.Content</p>
                }
            </div>
            <input type="text"
                   placeholder="New Note"
                   @bind="vm.NewNote" />
            <button class="btn btn-secondary"
                    type="submit"
                    @onclick="vm.AddNote">
                Add Note
            </button>
            <br />
        </div>
    </div>
    <br />
    <h3>Restrictions:</h3>
    <ul class="jumbotron centered">
        @foreach (var restriction in vm.GetRestrictions())
        {
            <li>@restriction.Name</li>
        }
    </ul>

    <input type="number"
           @bind="vm.NewRestrictionId" />
    <button class="btn btn-secondary"
            type="submit"
            @onclick="vm.AddRestriction">
        Add Restriction
    </button>
</div>

@code {
    [Parameter]
    public int id { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await vm.LoadStudentAsync(id);
    }

    protected override async Task OnInitializedAsync()
    {
    }

    private async Task runAndReloadAsync(Action action)
    {
        await Task.Run(action);
        await vm.LoadStudentAsync(id);
    }

}